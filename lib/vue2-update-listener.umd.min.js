(function(n,t){"object"===typeof exports&&"object"===typeof module?module.exports=t(require("vue")):"function"===typeof define&&define.amd?define([],t):"object"===typeof exports?exports["vue2-update-listener"]=t(require("vue")):n["vue2-update-listener"]=t(n["Vue"])})("undefined"!==typeof self?self:this,(function(n){return function(){"use strict";var t={274:function(t){t.exports=n}},e={};function o(n){var i=e[n];if(void 0!==i)return i.exports;var r=e[n]={exports:{}};return t[n](r,r.exports,o),r.exports}!function(){o.n=function(n){var t=n&&n.__esModule?function(){return n["default"]}:function(){return n};return o.d(t,{a:t}),t}}(),function(){o.d=function(n,t){for(var e in t)o.o(t,e)&&!o.o(n,e)&&Object.defineProperty(n,e,{enumerable:!0,get:t[e]})}}(),function(){o.o=function(n,t){return Object.prototype.hasOwnProperty.call(n,t)}}(),function(){o.r=function(n){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})}}(),function(){o.p=""}();var i={};return function(){if(o.r(i),o.d(i,{default:function(){return N}}),"undefined"!==typeof window){var n=window.document.currentScript,t=n&&n.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);t&&(o.p=t[1])}var e=o(274),r=o.n(e);function s(n,t,e){return(o,i=!0)=>new Promise(((s,c)=>{const a=Object.assign({},t,o),l=r().extend(n),m=new l({el:document.createElement("div"),propsData:a});m.$on("cancel",(function(n){this.$destroy();const t=this.$el.parentElement;t&&t.removeChild(this.$el),c(n)})),m.$on("confirm",(function(n){if(i){this.$destroy();const n=this.$el.parentElement;n&&n.removeChild(this.$el)}s(n,this)})),e||(e=document.body),e.appendChild(m.$el)}))}var c=function(){var n=this,t=n._self._c;return t(n.confirmTypeNames[n.type],{tag:"component",attrs:{content:n.content},on:{confirm:n.confirm,cancel:n.cancel}})},a=[],l=function(){var n=this,t=n._self._c;return t("ConfirmMask",[t("div",{staticClass:"confirm-qingmu__body"},[t("div",{staticClass:"confirm-qingmu__wrapper"},[t("div",{staticClass:"confirm-qingmu__title"},[n._v(" 新版上线啦！ ")]),t("div",{staticClass:"confirm-qingmu__content"},[t("div",{staticClass:"confirm-qingmu__desc"},[n._v(" "+n._s(n.content)+" ")])]),t("div",{staticClass:"confirm-qingmu__footer"},[t("div",{staticClass:"confirm-qingmu__btn confirm-qingmu__btn--confirm",on:{click:n.confirm}},[n._v(" 立即更新 ")]),t("div",{staticClass:"confirm-qingmu__btn confirm-qingmu__btn--cancel",on:{click:n.cancel}},[t("span",[n._v("暂不更新")])])])])])])},m=[],f=function(){var n=this,t=n._self._c;return t("div",{staticClass:"confirm-mask update-confirm-loader"},[n._t("default")],2)},u=[];function d(n,t,e,o,i,r,s,c){var a,l="function"===typeof n?n.options:n;if(t&&(l.render=t,l.staticRenderFns=e,l._compiled=!0),o&&(l.functional=!0),r&&(l._scopeId="data-v-"+r),s?(a=function(n){n=n||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,n||"undefined"===typeof __VUE_SSR_CONTEXT__||(n=__VUE_SSR_CONTEXT__),i&&i.call(this,n),n&&n._registeredComponents&&n._registeredComponents.add(s)},l._ssrRegister=a):i&&(a=c?function(){i.call(this,(l.functional?this.parent:this).$root.$options.shadowRoot)}:i),a)if(l.functional){l._injectStyles=a;var m=l.render;l.render=function(n,t){return a.call(t),m(n,t)}}else{var f=l.beforeCreate;l.beforeCreate=f?[].concat(f,a):[a]}return{exports:n,options:l}}var p={},_=d(p,f,u,!1,null,null,null),v=_.exports,h={components:{ConfirmMask:v},props:{content:{type:String,default:""},type:{type:String,default:"qingmu"}},methods:{cancel(){this.$emit("cancel")},confirm(){this.$emit("confirm")}}},y={name:"UpdateConfirmQingmu",mixins:[h]},C=y,g=d(C,l,m,!1,null,null,null),b=g.exports,w=function(){var n=this,t=n._self._c;return t("ConfirmMask",[t("div",{staticClass:"confirm-element__wrapper"},[t("div",{staticClass:"confirm-element__header"},[t("div",{staticClass:"confirm-element__title"},[n._v(" 提示 ")]),t("div",{staticClass:"confirm-element__close",on:{click:n.cancel}},[n._v(" × ")])]),t("div",{staticClass:"confirm-element__content"},[t("div",{staticClass:"confirm-element__desc"},[n._v(" "+n._s(n.content)+" ")])]),t("div",{staticClass:"confirm-element__btns"},[t("div",{staticClass:"confirm-element__btn confirm-element__btn--default",on:{click:n.cancel}},[n._v(" 取消 ")]),t("div",{staticClass:"confirm-element__btn confirm-element__btn--primary",on:{click:n.confirm}},[n._v(" 确定 ")])])])])},x=[],$={name:"UpdateConfirmElement",mixins:[h]},S=$,q=d(S,w,x,!1,null,null,null),E=q.exports,T={name:"UpdateConfirm",components:{UpdateConfirmQingmu:b,UpdateConfirmElement:E},mixins:[h],data(){return{confirmTypeNames:{qingmu:"UpdateConfirmQingmu",element:"UpdateConfirmElement"}}}},j=T,P=d(j,c,a,!1,null,null,null),U=P.exports;async function k(n,t){return s(U,n,t)()}const O={install(n,t){let e,o,i=!1;const r=async()=>fetch(`${t.versionUrl||"/dist"}/version.json?timeStamp=`+Date.now()).then((n=>n.json())).catch((n=>{console.log(n)})),s=async()=>{const n=(await r()).commitHash;return n!==e},c=()=>{o&&(console.log("停止检查更新"),clearInterval(o),o="")},a=async()=>{if(!t.showTest&&!1===t.isTip)return;const n=await r();n&&!i&&(e=n.commitHash,console.log("开始检查更新"),o=setInterval((async()=>{i=t.showTest||await s(),(i&&n.isTip||t.showTest)&&(console.log("有新版本"),c(),await l())}),t.interval||3e5))},l=async()=>{try{const n=t.modalProps&&t.modalProps.content;await k({content:n?t.modalProps.content:"为了更好的版本体验请更新到最新版本",type:t.type||"qingmu"},t.modalProps&&t.modalProps.mountedEl),window.location.reload()}catch(n){console.log(n)}},m=()=>{document.hidden?c():a()};document.addEventListener("visibilitychange",m);const f=async n=>{"SCRIPT"===n.target.nodeName&&(c(),await l())};t.isListenJSError&&window.addEventListener("error",f),a()}};var M=O,R=M,N=R}(),i}()}));
//# sourceMappingURL=vue2-update-listener.umd.min.js.map