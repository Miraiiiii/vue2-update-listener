(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t(require("vue")):"function"===typeof define&&define.amd?define([],t):"object"===typeof exports?exports["vue2-update-listener"]=t(require("vue")):e["vue2-update-listener"]=t(e["Vue"])})("undefined"!==typeof self?self:this,(function(e){return function(){"use strict";var t={274:function(t){t.exports=e}},n={};function i(e){var o=n[e];if(void 0!==o)return o.exports;var r=n[e]={exports:{}};return t[e](r,r.exports,i),r.exports}!function(){i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,{a:t}),t}}(),function(){i.d=function(e,t){for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){i.p=""}();var o={};return function(){if(i.r(o),i.d(o,{default:function(){return R}}),"undefined"!==typeof window){var e=window.document.currentScript,t=e&&e.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);t&&(i.p=t[1])}var n=i(274),r=i.n(n);function s(){let e=0;const t=document.getElementsByTagName("*");for(let n=0;n<t.length;n++){const i=window.getComputedStyle(t[n]).zIndex;isNaN(i)||(e=Math.max(e,parseInt(i,10)))}return e||2001}function a(e,t,n){return(i,o=!0)=>new Promise(((a,c)=>{const l=Object.assign({},t,i),m=s(),d=r().extend(e),f=new d({el:document.createElement("div"),propsData:{...l,zIndex:m}});f.$on("cancel",(function(e){this.$destroy();const t=this.$el.parentElement;t&&t.removeChild(this.$el),c(e)})),f.$on("confirm",(function(e){if(o){this.$destroy();const e=this.$el.parentElement;e&&e.removeChild(this.$el)}a(e,this)})),n||(n=document.body),n.appendChild(f.$el)}))}var c=function(){var e=this,t=e._self._c;return t(e.confirmTypeNames[e.type],{tag:"component",attrs:{content:e.content},on:{confirm:e.confirm,cancel:e.cancel}})},l=[],m=function(){var e=this,t=e._self._c;return t("ConfirmMask",{attrs:{"z-index":e.zIndex}},[t("div",{staticClass:"confirm-qingmu__body"},[t("div",{staticClass:"confirm-qingmu__wrapper"},[t("div",{staticClass:"confirm-qingmu__title"},[e._v(" 新版上线啦！ ")]),t("div",{staticClass:"confirm-qingmu__content"},[t("div",{staticClass:"confirm-qingmu__desc"},[e._v(" "+e._s(e.content)+" ")])]),t("div",{staticClass:"confirm-qingmu__footer"},[t("div",{staticClass:"confirm-qingmu__btn confirm-qingmu__btn--confirm",on:{click:e.confirm}},[e._v(" 立即更新 ")]),t("div",{staticClass:"confirm-qingmu__btn confirm-qingmu__btn--cancel",on:{click:e.cancel}},[t("span",[e._v("暂不更新")])])])])])])},d=[],f=function(){var e=this,t=e._self._c;return t("div",{staticClass:"confirm-mask update-confirm-loader",style:{zIndex:e.zIndex}},[e._t("default")],2)},u=[],p={name:"ConfirmMask",props:{zIndex:{type:Number,default:2001}}},_=p;function v(e,t,n,i,o,r,s,a){var c,l="function"===typeof e?e.options:e;if(t&&(l.render=t,l.staticRenderFns=n,l._compiled=!0),i&&(l.functional=!0),r&&(l._scopeId="data-v-"+r),s?(c=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"===typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),o&&o.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(s)},l._ssrRegister=c):o&&(c=a?function(){o.call(this,(l.functional?this.parent:this).$root.$options.shadowRoot)}:o),c)if(l.functional){l._injectStyles=c;var m=l.render;l.render=function(e,t){return c.call(t),m(e,t)}}else{var d=l.beforeCreate;l.beforeCreate=d?[].concat(d,c):[c]}return{exports:e,options:l}}var h=v(_,f,u,!1,null,null,null),y=h.exports,g={components:{ConfirmMask:y},props:{content:{type:String,default:""},type:{type:String,default:"qingmu"},zIndex:{type:Number,default:2001}},methods:{cancel(){this.$emit("cancel")},confirm(){this.$emit("confirm")}}},C={name:"UpdateConfirmQingmu",mixins:[g]},w=C,x=v(w,m,d,!1,null,null,null),b=x.exports,S=function(){var e=this,t=e._self._c;return t("ConfirmMask",{attrs:{"z-index":e.zIndex}},[t("div",{staticClass:"confirm-element__wrapper"},[t("div",{staticClass:"confirm-element__header"},[t("div",{staticClass:"confirm-element__title"},[e._v(" 提示 ")]),t("div",{staticClass:"confirm-element__close",on:{click:e.cancel}},[e._v(" × ")])]),t("div",{staticClass:"confirm-element__content"},[t("div",{staticClass:"confirm-element__desc"},[e._v(" "+e._s(e.content)+" ")])]),t("div",{staticClass:"confirm-element__btns"},[t("div",{staticClass:"confirm-element__btn confirm-element__btn--default",on:{click:e.cancel}},[e._v(" 取消 ")]),t("div",{staticClass:"confirm-element__btn confirm-element__btn--primary",on:{click:e.confirm}},[e._v(" 确定 ")])])])])},$=[],q={name:"UpdateConfirmElement",mixins:[g]},E=q,I=v(E,S,$,!1,null,null,null),T=I.exports,P={name:"UpdateConfirm",components:{UpdateConfirmQingmu:b,UpdateConfirmElement:T},mixins:[g],data(){return{confirmTypeNames:{qingmu:"UpdateConfirmQingmu",element:"UpdateConfirmElement"}}}},j=P,k=v(j,c,l,!1,null,null,null),z=k.exports;async function N(e,t){return a(z,e,t)()}const O={install(e,t){let n,i,o=!1,r=!1;t.refreshSameOrigin&&window.addEventListener("storage",(function(e){"refreshPage"===e.key&&"true"===e.newValue&&(localStorage.removeItem("refreshPage"),window.location.reload())}));const s=async()=>fetch(`${t.versionUrl||"/dist"}/version.json?timeStamp=`+Date.now()).then((e=>e.json())).catch((e=>{r=!0})),a=async()=>{const e=(await s()).commitHash;return e!==n},c=()=>{i&&(clearInterval(i),i="")},l=async e=>{o=t.showTest||await a(),(o&&e.isTip||t.showTest)&&(c(),await d())},m=async(e=!1)=>{if(!t.showTest&&(!1===t.isTip||r))return;const a=await s();a&&!o&&(e||(n=a.commitHash),e&&await l(a),i=setInterval((async()=>await l(a)),t.interval||3e5))},d=async()=>{try{const e=document.querySelector(".confirm-mask.update-confirm-loader");if(e)return;const n=t.modalProps&&t.modalProps.content;await N({content:n?t.modalProps.content:"为了更好的版本体验请更新到最新版本",type:t.type||"qingmu"},t.modalProps&&t.modalProps.mountedEl),t.refreshSameOrigin?(localStorage.setItem("refreshPage","true"),window.location.reload()):window.location.reload()}catch(e){}},f=()=>{document.hidden?c():m(!0)};document.addEventListener("visibilitychange",f);const u=async e=>{if(e.target&&"SCRIPT"===e.target.nodeName){e.target.src;c(),await d()}};t.isListenJSError&&window.addEventListener("error",u),m()}};var U=O,M=U,R=M}(),o}()}));